<div class="container">





<p>Add some links back to the raft page and one back to all raft index</p>

<p> Testing methods... </p>
<%= user_has_voted(current_user, @event) %>
<%= raft_has_voted(@event, @raft) %>
<p> *************** </p>
<% if user_has_voted(current_user, @event)%>

<%if !current_user.rsvp?(@event) %>
  <div class="rsvp-drsvp">
    <%= form_for [@event, Rsvp.new], method: :post,  remote: true, :html => {:id => "rsvp-btn"} do |f|  %>
      <%= f.submit "GET ON BOARD!",:class => "waves-effect purple lighten-1 btn" %>
    <% end  %>
<% else %>
    <%= form_for [@event, @rsvp], method: :delete,  remote: true, :html => {:id => "drsvp-btn"} do |f|  %>
      <%= f.submit "Hop on off",:class => "waves-effect purple lighten-1 btn" %>
    <% end  %>
  </div>
<% end %>

<h5 class="center">
  <%= @event.name %>
</h5>
  <div class="card-panel teal">
    <% if @event.polls.length == 3 %>
      <p> The leading event details are <%= highest_choice(@events_polls[0]).split(",")[0] %> on <%= highest_choice(@events_polls[1]) %> at <%= highest_choice(@events_polls[2]) %> </p>
    <% end %>
  </div>



<html lang="en">
    <head>
    <meta charset="utf-8">
    <title>Google Map Address</title>
    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=<%=ENV['GOOGLE_API_KEY'] %>&sensor=false"></script>

    <script type="text/javascript">

            var geocoder = new google.maps.Geocoder();
    var address = "<%= highest_choice(@events_polls[0]) %>";

    geocoder.geocode( { 'address': address}, function(results, status) {

      if (status == google.maps.GeocoderStatus.OK) {
        var latitude = results[0].geometry.location.lat();
        var longitude = results[0].geometry.location.lng();


        initialize(latitude,longitude);

                }

        });


    function initialize(latitude,longitude) {
        var latlng = new google.maps.LatLng(latitude,longitude);

        var myOptions = {
          zoom: 14,
          center: latlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          mapTypeControl: false
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),myOptions);
        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
          position: latlng,
          map: map,
          title:"location : Dublin"
        });
        google.maps.event.addListener(marker, 'click', function() {
              infowindow.setContent(address);
              infowindow.open(map, this);
            });
      }


</script>

    </head>
    <body>
    <div id="map_canvas" style="width:100%; height:300px"></div>

            </body>
    </html>







<div class="card-panel orange">
  <ul class-"attendees">
    <p> Who's going? </p>
    <% @event.attendees.each do |attendee| %>
      <li>
        <%= attendee.first_name%> <%=attendee.last_name %>
        <% if !attendee.accounted_for(@event) %>
          <%= form_for [@event, rsvp = Rsvp.find_by(user_id: attendee.id, event_id: @event.id)], method: :patch do |f|%>
            <%= f.submit "Present" %>
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>


<div class= "comments card-panel lime">

<%= render partial: '/comments/new_event', locals: { commentable: @event } %>

<% @event.comments.limit(3).each do |comment| %>
<p> <%= comment.body %> </p>
<em><%= comment.author.username %></em>
<% end %>

</div>
<% end %>

</div>
<%= render partial: 'polls/answer_form' %>
</div>
<b>

